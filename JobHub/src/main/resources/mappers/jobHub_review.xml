<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">



<mapper namespace="com.jobhub.review">

	<resultMap type="reviewDto" id="reviewResultMap">
		<id column="REVIEW_NUMBER" property="rNo" />
		<result column="REVIEW_TITLE" property="rTitle" />
		<result column="REVIEW_CONTENT" property="rContent" />
		<result column="REVIEW_SALARY" property="rSal" />
		<result column="REVIEW_WELFARE" property="rWel" />
		<result column="REVIEW_ENVIRONMENT" property="rEnv" />
		<result column="REVIEW_BOSS" property="rBoss" />
		<result column="REVIEW_BALANCE" property="rBal" />
		<result column="REVIEW_GOOD" property="rGood" />
		<result column="REVIEW_BAD" property="rBad" />
		<result column="REVIEW_AVERAGE" property="rAvg" />
		<result column="REVIEW_CREATE_DATE" property="rCreDate" />
		<result column="REVIEW_MODIFY_DATE" property="rModDate" />
		<result column="PERSONAL_NUMBER" property="rPNo" />
		<result column="COMPANY_NUMBER" property="rCNo" />
	</resultMap>
	
	<select id="reviewSelectCNo" parameterType="map" resultType="java.lang.Integer">
		SELECT (SELECT COMPANY_NUMBER
                FROM COMPANY
                WHERE COMPANY_NAME = PERSONAL_COMPANY)
		FROM PERSONAL
		WHERE PERSONAL_NUMBER = #{pNo}
	</select>
	
	<select id="reviewSelectTotalCount" resultType="java.lang.Integer">
		SELECT COUNT(*)
		FROM REVIEW
		WHERE COMPANY_NUMBER = #{cNo}
	</select>
	
	<select id="reviewSelectList" parameterType="map" resultMap="reviewResultMap">
		SELECT RNR.RN, RNR.REVIEW_NUMBER, RNR.REVIEW_SALARY, RNR.REVIEW_WELFARE, RNR.REVIEW_ENVIRONMENT, RNR.REVIEW_BOSS, RNR.REVIEW_BALANCE, RNR.REVIEW_AVERAGE, RNR.REVIEW_TITLE, RNR.REVIEW_CONTENT, RNR.COMPANY_NUMBER, RNR.PERSONAL_NUMBER
	    FROM (
	            SELECT ROWNUM AS RN, REVIEW_NUMBER, REVIEW_SALARY, REVIEW_WELFARE, REVIEW_ENVIRONMENT, REVIEW_BOSS, REVIEW_BALANCE, REVIEW_AVERAGE, REVIEW_TITLE, REVIEW_CONTENT, COMPANY_NUMBER, PERSONAL_NUMBER
	            FROM (
                     SELECT REVIEW_NUMBER, REVIEW_SALARY, REVIEW_WELFARE, REVIEW_ENVIRONMENT, REVIEW_BOSS, REVIEW_BALANCE, REVIEW_AVERAGE, REVIEW_TITLE, REVIEW_CONTENT, COMPANY_NUMBER, PERSONAL_NUMBER
                     FROM REVIEW R
                     ORDER BY REVIEW_NUMBER DESC
                		)
                WHERE COMPANY_NUMBER = #{cNo}
        		)RNR
		WHERE RNR.RN BETWEEN #{start} AND #{end}
	</select>
	
	<select id="reviewSelectOne" parameterType="int" resultMap="reviewResultMap">
		SELECT 	REVIEW_NUMBER, REVIEW_TITLE, REVIEW_CONTENT, REVIEW_SALARY, REVIEW_WELFARE, REVIEW_ENVIRONMENT, REVIEW_BOSS, REVIEW_BALANCE, REVIEW_AVERAGE, REVIEW_MODIFY_DATE, REVIEW_MODIFY_DATE, COMPANY_NUMBER
		FROM 	REVIEW
		WHERE 	REVIEW_NUMBER = #{rNo}
	</select>
	
	<select id="reviewSelectAllList" resultMap="reviewResultMap">
		SELECT REVIEW_SALARY, REVIEW_WELFARE, REVIEW_ENVIRONMENT,
				REVIEW_BOSS, REVIEW_BALANCE, REVIEW_AVERAGE
		FROM REVIEW
		WHERE COMPANY_NUMBER = #{cNo}
	</select>	
	
	<insert id="reviewInsertOne" parameterType="reviewDto">
		INSERT INTO REVIEW
			(REVIEW_NUMBER, REVIEW_TITLE, REVIEW_CONTENT, REVIEW_SALARY, 
			REVIEW_WELFARE, REVIEW_ENVIRONMENT, REVIEW_BOSS, 
			REVIEW_BALANCE, REVIEW_AVERAGE, REVIEW_CREATE_DATE, REVIEW_MODIFY_DATE,
            PERSONAL_NUMBER, COMPANY_NUMBER)
		VALUES(REVIEW_NUMBER_SEQ.NEXTVAL, #{rTitle}, #{rContent}, #{rSal}, 
			#{rWel}, #{rEnv}, #{rBoss}, 
 			#{rBal}, #{rAvg}, SYSDATE, SYSDATE, 
			#{rPNo}, #{rCNo})
   </insert>
   
   <update id="reviewUpdateOne" parameterType="map">
		UPDATE REVIEW
	    SET REVIEW_TITLE = #{rTitle}, REVIEW_CONTENT = #{rContent}, REVIEW_SALARY = #{rSal}, 
			REVIEW_WELFARE = #{rWel}, REVIEW_ENVIRONMENT = #{rEnv}, REVIEW_BOSS = #{rBoss}, 
			REVIEW_BALANCE = #{rBal}, REVIEW_AVERAGE = #{rAvg},
			REVIEW_MODIFY_DATE = SYSDATE, PERSONAL_NUMBER = #{rPNo}
	    WHERE REVIEW_NUMBER = #{rNo}
	</update>
	
	<delete id="reviewDeleteOne" parameterType="int">
		DELETE FROM REVIEW
		WHERE REVIEW_NUMBER = #{rNo}
	</delete>
   
</mapper>