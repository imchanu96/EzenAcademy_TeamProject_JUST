<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">



<mapper namespace="com.jobhub.company">

	<resultMap type="companyMemberDto" id="companyMemberResultMap">
		<id column="COMPANY_NUMBER" property="cNo" />
		<result column="COMPANY_NAME" property="cName" />
		<result column="COMPANY_ADDRESS" property="cAdd" />
		<result column="COMPANY_TYPE" property="cType" />
		<result column="COMPANY_ESTABLISH_DATE" property="cEstDate" 
		javaType="java.util.Date" />
		<result column="COMPANY_HOMEPAGE" property="cHomepage" />
		<result column="COMPANY_BUSINESS_DETAIL" property="cBusDetail" />
		<result column="COMPANY_ID" property="cId" />
		<result column="COMPANY_PASSWORD" property="cPwd" />
		<result column="COMPANY_CODE" property="cCode" />
		<result column="COMPANY_LICENSE" property="cLicense" />
		<result column="COMPANY_LOGO" property="cLogo" />
		<result column="COMPANY_PRESIDENT_NAME" property="cPrName" />
		<result column="COMPANY_INCHARGE_NAME" property="cInChargeName" />
		<result column="COMPANY_INCHARGE_EMAIL" property="cInChargeEmail" />
		<result column="COMPANY_INCHARGE_PHONENUMBER" property="cInChargePhoneNum" />
		<result column="COMPANY_PREFER" property="cPrefer" />
		<result column="PERMISSION" property="permission" />
		<result column="COMPANY_CREATE_DATE" property="cCreDate" />
		<result column="COMPANY_MODIFY_DATE" property="cModDate" />
		<result column="CONNECTION_TIME" property="connTime" />
		<result column="DISCONNECTION_TIME" property="disconnTime" />

	</resultMap>
	
	<select id="companyMemberSelectTotalCount" resultType="java.lang.Integer">
		SELECT COUNT(*)
		FROM COMPANY
	</select>

	<select id="companyMemberSelectList"  parameterType="map" resultMap="companyMemberResultMap">
		SELECT RNC.RN, RNC.COMPANY_NUMBER, RNC.COMPANY_NAME, RNC.COMPANY_TYPE, RNC.COMPANY_HOMEPAGE, RNC.COMPANY_CREATE_DATE
		FROM
		    (SELECT ROWNUM RN, COMPANY_NUMBER, COMPANY_NAME, COMPANY_TYPE, COMPANY_HOMEPAGE, COMPANY_CREATE_DATE
		        FROM (
		             SELECT COMPANY_NUMBER, COMPANY_NAME, COMPANY_TYPE, COMPANY_HOMEPAGE, COMPANY_CREATE_DATE
		             FROM COMPANY C
		             ORDER BY COMPANY_CREATE_DATE DESC
		         )
		    ) RNC
		WHERE RNC.RN BETWEEN #{start} AND #{end}
	</select>
	
	<select id="memberSelectList"  parameterType="map" resultMap="companyMemberResultMap">
		SELECT PERSONAL.PERSONAL_NUMBER, PERSONAL.PERSONAL_NAME, PERSONAL.PERSONAL_ID
			, PERSONAL.PERSONAL_NICKNAME, PERSONAL.PERMISSION, PERSONAL.PERSONAL_CREATE_DATE
			, PERSONAL.PERSONAL_MODIFY_DATE
		FROM( SELECT ROWNUM AS RNUM, P.PERSONAL_NUMBER, P.PERSONAL_NAME, P.PERSONAL_ID
			, P.PERSONAL_NICKNAME, P.PERMISSION, P.PERSONAL_CREATE_DATE, P.PERSONAL_MODIFY_DATE
        		FROM( SELECT PERSONAL_NUMBER, PERSONAL_NAME, PERSONAL_ID,PERSONAL_NICKNAME
        			, PERMISSION, PERSONAL_CREATE_DATE, PERSONAL_MODIFY_DATE
                		FROM PERSONAL
                		ORDER BY PERSONAL_CREATE_DATE DESC
                	) P
			) PERSONAL
<!-- 		WHERE PERSONAL.RNUM BETWEEN #{start} AND #{end} -->
	</select>
	

	<select id="companyMemberExist" parameterType="map" resultMap="companyMemberResultMap">
		SELECT COMPANY_NUMBER, COMPANY_CODE, COMPANY_PASSWORD, PERMISSION
		SELECT COMPANY_NUMBER, COMPANY_CODE, COMPANY_PASSWORD, COMPANY_INCHARGE_NAME
				,COMPANY_INCHARGE_EMAIL, COMPANY_INCHARGE_PHONENUMBER, COMPANY_NAME
				,COMPANY_ADDRESS, COMPANY_TYPE, COMPANY_ESTABLISH_DATE
				, COMPANY_HOMEPAGE, COMPANY_BUSINESS_DETAIL
		 FROM COMPANY
		 WHERE COMPANY_CODE = #{cCode} AND COMPANY_PASSWORD = #{cPwd}
	
	</select>
	
	<insert id="companyInsertOne" parameterType="companyMemberDto">
<!-- 		useGeneratedKeys="true" keyProperty="pNo"> -->
<!-- 		<selectKey keyProperty="pNo" resultType="int" order="BEFORE"> -->
<!-- 			SELECT COMPANY_NUMBER_SEQ.NEXTVAL -->
<!-- 			FROM DUAL -->
<!-- 		</selectKey> -->
		INSERT INTO COMPANY
			VALUE(COMPANY_NUMBER, COMPANY_NAME, COMPANY_ADDRESS
				, COMPANY_TYPE, COMPANY_BUSINESS_DETAIL
    			, COMPANY_PASSWORD, COMPANY_CODE
    			, COMPANY_LICENSE, COMPANY_INCHARGE_NAME, COMPANY_INCHARGE_EMAIL
			    , COMPANY_INCHARGE_PHONENUMBER
			    , PERMISSION,COMPANY_CREATE_DATE, COMPANY_MODIFY_DATE
			    , CONNECTION_TIME, DISCONNECTION_TIME)
			VALUES(COMPANY_NUMBER_SEQ.NEXTVAL, #{cName}, #{cAdd}
				, #{cType}, #{cBusDetail}
				, #{cPwd}, #{cCode}, #{cLicense}
				, #{cInChargeName}, #{cInChargeEmail}
				, #{cInChargePhoneNum}
				, 5, SYSDATE, SYSDATE, SYSDATE, SYSDATE)

	</insert>
	
	<update id="companyMembercInChargeNameUpdateOne" parameterType="companyMemberDto">
		UPDATE COMPANY
		 SET COMPANY_INCHARGE_NAME = #{cInChargeName}
		 WHERE COMPANY_NUMBER = #{cNo}
	</update>
	
	<update id="companyMembercInChargeEmailUpdateOne" parameterType="companyMemberDto">
		UPDATE COMPANY
		 SET COMPANY_INCHARGE_EMAIL = #{cInChargeEmail}
		 WHERE COMPANY_NUMBER = #{cNo}
	</update>	
	
	<update id="companyMembercInChargePhoneNumUpdateOne" parameterType="companyMemberDto">
		UPDATE COMPANY
		 SET COMPANY_INCHARGE_PHONENUMBER = #{cInChargePhoneNum}
		 WHERE COMPANY_NUMBER = #{cNo}
	</update>
	
	<update id="companyMembercNameUpdateOne" parameterType="companyMemberDto">
		UPDATE COMPANY
		 SET COMPANY_NAME = #{cName}
		 WHERE COMPANY_NUMBER = #{cNo}
	</update>
	
	<update id="companyMembercAddUpdateOne" parameterType="companyMemberDto">
		UPDATE COMPANY
		 SET COMPANY_ADDRESS = #{cAdd}
		 WHERE COMPANY_NUMBER = #{cNo}
	</update>
	
	<update id="companyMembercTypeUpdateOne" parameterType="companyMemberDto">
		UPDATE COMPANY
		 SET COMPANY_TYPE = #{cType}
		 WHERE COMPANY_NUMBER = #{cNo}
	</update>
	
	<update id="companyMembercEstDateUpdateOne" parameterType="companyMemberDto">
		UPDATE COMPANY
		SET COMPANY_ESTABLISH_DATE = #{cEstDate}
		WHERE COMPANY_NUMBER = #{cNo}
	</update>
	
	<update id="companyMembercHomepageUpdateOne" parameterType="companyMemberDto">
		UPDATE COMPANY
		 SET COMPANY_HOMEPAGE = #{cHomepage}
		 WHERE COMPANY_NUMBER = #{cNo}
	</update>
	
	<update id="companyMembercBusDetailUpdateOne" parameterType="companymemberDto">
		UPDATE COMPANY
		 SET COMPANY_BUSINESS_DETAIL = #{cBusDetail}
		 WHERE COMPANY_NUMBER = #{cNo}
	</update>
</mapper>